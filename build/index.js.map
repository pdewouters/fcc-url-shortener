{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\nrequire('dotenv').config();\nimport express from 'express'\nconst app = express()\nimport exphbs from 'express-handlebars'\nimport validurl from 'valid-url'\nimport UrlModel from './inc/url_model'\n\napp.set('port', (process.env.PORT || 5000))\n\napp.engine('handlebars', exphbs({layoutsDir: __dirname + \"/views/layouts/\", defaultLayout: 'main'}))\napp.set('view engine', 'handlebars')\napp.set('views', __dirname + '/views')\napp.get('/', (req, res) => {\n    const baseUrl = req.protocol + '://' + req.get('Host')\n    res.render('home', {baseUrl: baseUrl})\n})\n\n// New URL to shorten\napp.get('/new/*', (req, res) => {\n    res.header(\"Content-Type\", \"application/json\")\n    const baseUrl = req.protocol + '://' + req.get('Host') + '/'\n    \n    if(validurl.isUri(req.params[0])){\n\n        if(baseUrl.indexOf(req.params[0]) !== -1) {\n            res.send(JSON.stringify({error:'you can\\'t shorten a URL from this domain!'}))\n        } else {\n            UrlModel.findOne({original:req.params[0]},(err, url) => {\n                if (err) console.log(err)\n                if(url) {\n                    res.send(JSON.stringify({original:url.original, short: baseUrl + url.id}))\n                } else {\n                    let url = new UrlModel( {original: req.params[0]} )\n        \n                    url.save( (err, url ) => {\n                        if (err) return err\n                            res.send(JSON.stringify({original:url.original, short: baseUrl + url.id}))\n                    })\n                }\n            })\n        }\n    \n    } else {\n        res.send(JSON.stringify({error: 'invalid url'}))\n    }\n})\n\n// Redirect to original URL http://siteurl/4\napp.get('/:id(\\\\d+)', (req, res) => {\n    UrlModel.findById(req.params.id, (err, url) => {\n        if (err) console.log(err)\n        if(url) {\n            res.redirect(url.original)\n        }\n    })\n})\n\n// Fallback\napp.get('/*', (req, res) => {\n    res.header(\"Content-Type\", \"application/json\")\n    res.send(JSON.stringify({'error':'invalid route'}))\n})\n\napp.listen(app.get('port'), () => {\n  console.log('Node app is running on port', app.get('port'));\n})"]}